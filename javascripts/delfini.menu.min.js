/*
 * Delfini UI - Drop Down Menu
 * -------------------------------
 *
 * ForwardFour Innovations: http://forwardfour.com/
 * Delfini UI: http://delfiniui.com/
 * 
 * LICENSE
 * 
 * By viewing, using, or actively developing this framework in any way, you are
 * henceforth bound the license agreement, and all of its changes, set forth by
 * ForwardFour Innovations or the Delfini UI Group. The license can be found,
 * in its entirety, at this address: http://delfiniui.com/license.
 * 
 * Copyright (c) 2012 and Onwards, ForwardFour Innovations & The Delfini UI Group
 * http://delfiniui.com/license [Proprietary]
 *
 *
 *
 * Example usage:
 *
 * <ul class="dropdown" data-name="menu">      The "dropdown" class will activate this UI widget for a given
 * <li>Option</li>                             unordered list
 * <li>Option</li>                             The "data-name" attribute will be the name of the HTML element
 * <li class="selected">Option</li>            when the data is submitted in a <form>
 * <li>A longer option</li>                    The "selected" class shows the currently selected option
 * </ul>
 *
 *
 *
 * Events dispatched:
 *  - dropdownReady                            The unordered list has been properly modified and is ready for use
 *  - menuOpened                               The user has opened the menu
 *  - menuClosed [FORTH COMING]                The user has closed the menu
 *  - menuItemSelected                         A menu item has been selected
 *  - newMenuItemSelected                      A different menu item than the previously selected item was chosen
*/

(function(a){a(document).ready(function(){a("ul.dropdown").wrap('<div class="dropdownWrapper" />').after(function(){var b=a(this);a(this).trigger("dropdownReady");return'<input name="'+b.attr("data-name")+'" type="hidden" value="'+b.children("li.selected").text()+'"/>'});a("body").delegate("ul.dropdown","click",function(){var b=a(this);var d=b.offset().left;var c=b.offset().top;var e=a(window).height();b.addClass("open");if(c+b.height()>e){c-=(c+b.height()+20)-e}b.css({left:d+"px",position:"absolute",top:c+"px"});b.trigger("menuOpened")});a(document).click(function(b){if(!a(b.target).is("ul.dropdown")&&!a(b.target).parents().is("ul.dropdown")){a("ul.dropdown").removeClass("open").removeAttr("style")}});a("body").delegate("ul.dropdown li","click",function(d){var c=a(this);var f=c.parent();var b=true;if(f.hasClass("open")){if(c.parent().children("li.selected").is(c)){b=false}c.addClass("reservedItemCurrentlySelcted").siblings("li.selected").removeClass("selected").siblings("li.reservedItemCurrentlySelcted").removeClass("reservedItemCurrentlySelcted").addClass("selected");f.removeClass("open").removeAttr("style");d.stopPropagation();f.siblings("input").val(c.text());currentMenu.trigger("menuItemSelected");if(b){currentMenu.trigger("newMenuItemSelected")}}})})})(jQuery);